/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */
plugins{
    // Apply the java plugin to add support for Java
    id 'java'
    id 'com.github.johnrengelman.shadow' version '5.2.0'
    // https://github.com/beryx/badass-runtime-plugin
    // gradlew clean jpackage
    id 'org.beryx.runtime' version '1.8.4'
    //https://docs.oracle.com/en/java/javase/11/tools/jdeps.html#GUID-A543FEBE-908A-49BF-996C-39499367ADB4
    // jdep JAR dependency optimisation
    id "org.kordamp.gradle.jdeps" version "0.11.0"
}

java {
    sourceCompatibility = JavaVersion.VERSION_14
    targetCompatibility = JavaVersion.VERSION_14
}

repositories {
    maven {url = "https://repo.osgeo.org/repository/release/"}
    maven {url = "https://repo.spring.io/plugins-release/"}
    jcenter()
    mavenCentral()
}

configurations {
    // create 'shade' configuration
    shade
    // let's feed off 'compile'
    compile.extendsFrom shade
}

dependencies {
    shade 'org.geotools:gt-swing:23.0'
    shade 'org.geotools:gt-shapefile:23.0'
    shade 'com.bulenkov:darcula:2018.2'
    compile 'com.intellij:forms_rt:7.0.3'
}

// https://docs.gradle.org/current/userguide/application_plugin.html
application {
    // Define the main class for the application.
    mainClassName = 'com.github.hololand.objecttweaker.Program'
}
// WORKING BACKUP!
//runtime {
//    modules = ["java.sql", "java.desktop", "java.naming"]
//    jpackage {
//        jpackageHome = 'C:\\Program Files\\Java\\jdk-14.0.1'
//        outputDir = 'com.github.hololand.objecttweaker'
//        // imageOutputDir = file("$buildDir/my-packaging-image")
//        // installerOutputDir = file("$buildDir/my-packaging-installer")
//        imageName = project.name
//        imageOptions = ['--win-console']
//        skipInstaller = false
//        installerName = project.name + '_installer'
//        installerType = 'msi'
//        installerOptions = ['--win-menu', '--win-shortcut']
//    }
//}

runtime {
    options = ['--strip-debug', '--compress', '2', '--no-header-files', '--no-man-pages', '--strip-native-commands']
    modules = ["java.sql", "java.desktop", "java.naming"]
    jpackage {
        jpackageHome = 'C:\\Program Files\\Java\\jdk-14.0.1'
        outputDir = 'com.github.hololand.objecttweaker'
        //imageOutputDir = file("$buildDir/my-packaging-image")
        // installerOutputDir = file("$buildDir/my-packaging-installer")
        imageName = project.name
        imageOptions = ['--icon', 'src/main/resources/favicon40.ico', '--app-version', 1.4, '--vendor', 'Hololand']
        skipInstaller = false
        installerType = 'msi'
        installerOptions = ['--win-menu', '--win-shortcut']
    }
}

shadowJar {
    configurations = [project.configurations.shade]
    mergeServiceFiles()
// Pick and choose what i want from my dependencies (inclusively)
//    dependencies {
//        include(dependency('com.google.guava:guava:28.2-jre'))
//    }
}

